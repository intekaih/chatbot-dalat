<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title>
      <div class="header-title">
        <ion-icon name="chatbubbles-outline"></ion-icon>
        <span>Chat Du Lịch Đà Lạt</span>
      </div>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="startNewConversation()" class="new-chat-btn">
        <ion-icon slot="icon-only" name="add-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content #chatContent>
  <div class="chat-container">
    @for (message of messages; track message.id) {
      <app-chat-bubble [message]="message"></app-chat-bubble>
    }

    @if (isLoading) {
      <div class="typing-indicator">
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <span class="typing-text">Đang xử lý...</span>
      </div>
    }
  </div>
</ion-content>

<ion-footer class="ion-no-border">
  @if (pendingImage) {
    <app-media-preview 
      [imageUrl]="pendingImage" 
      (cancel)="cancelImage()">
    </app-media-preview>
  }

  <div class="input-wrapper">
    @if (isRecording) {
      <div class="recording-indicator">
        <div class="recording-pulse"></div>
        <span>Đang ghi âm...</span>
      </div>
    }

    <div class="input-container">
      <div class="media-buttons">
        <button class="icon-btn" (click)="takePhoto()">
          <ion-icon name="camera-outline"></ion-icon>
        </button>
        <button class="icon-btn" (click)="pickPhoto()">
          <ion-icon name="image-outline"></ion-icon>
        </button>
        <button class="icon-btn" [class.recording]="isRecording" (click)="toggleRecording()">
          <ion-icon [name]="isRecording ? 'stop-circle' : 'mic-outline'"></ion-icon>
        </button>
      </div>

      <div class="message-input">
        <input
          type="text"
          [(ngModel)]="newMessage"
          placeholder="Nhập tin nhắn..."
          (keyup.enter)="sendMessage()"
          [disabled]="isRecording" />
      </div>

      <button class="send-btn" (click)="sendMessage()" [disabled]="isLoading || isRecording">
        <ion-icon name="send"></ion-icon>
      </button>
    </div>
  </div>
</ion-footer>
