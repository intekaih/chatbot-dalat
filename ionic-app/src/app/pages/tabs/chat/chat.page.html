<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title>
      <div class="header-title">
        <span class="title-icon">üå≤</span>
        <span>ƒê√† L·∫°t Travel</span>
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content #chatContent>
  <div class="chat-container">
    @if (messages.length === 0 || (messages.length === 1 && messages[0].id === 'welcome')) {
    <div class="welcome-section">
      <div class="welcome-card">
        <div class="welcome-icon">
          <ion-icon name="leaf"></ion-icon>
        </div>
        <h2>Ch√†o m·ª´ng ƒë·∫øn ƒê√† L·∫°t!</h2>
        <p>T√¥i l√† tr·ª£ l√Ω du l·ªãch th√¥ng minh, s·∫µn s√†ng gi√∫p b·∫°n kh√°m ph√° th√†nh ph·ªë ng√†n hoa</p>
      </div>

      <div class="suggestions-grid">
        <button class="suggestion-card" (click)="askSuggestion('ƒê·ªãa ƒëi·ªÉm n·ªïi ti·∫øng ·ªü ƒê√† L·∫°t?')">
          <div class="suggestion-icon mountain">
            <ion-icon name="trail-sign-outline"></ion-icon>
          </div>
          <span>ƒê·ªãa ƒëi·ªÉm n·ªïi ti·∫øng</span>
        </button>
        <button class="suggestion-card" (click)="askSuggestion('M√≥n ƒÉn ngon ·ªü ƒê√† L·∫°t?')">
          <div class="suggestion-icon food">
            <ion-icon name="restaurant-outline"></ion-icon>
          </div>
          <span>·∫®m th·ª±c ƒë·∫∑c s·∫£n</span>
        </button>
        <button class="suggestion-card" (click)="askSuggestion('Qu√°n c√† ph√™ view ƒë·∫πp?')">
          <div class="suggestion-icon coffee">
            <ion-icon name="cafe-outline"></ion-icon>
          </div>
          <span>C√† ph√™ view ƒë·∫πp</span>
        </button>
        <button class="suggestion-card" (click)="askSuggestion('L·ªãch tr√¨nh 2 ng√†y ·ªü ƒê√† L·∫°t?')">
          <div class="suggestion-icon calendar">
            <ion-icon name="calendar-outline"></ion-icon>
          </div>
          <span>L·ªãch tr√¨nh 2 ng√†y</span>
        </button>
      </div>
    </div>
    }

    @for (message of messages; track message.id) {
    @if (message.id !== 'welcome' || messages.length > 1) {
    <app-chat-bubble [message]="message"></app-chat-bubble>
    }
    }

    @if (isLoading) {
    <div class="typing-indicator">
      <div class="bot-avatar">üå≤</div>
      <div class="typing-content">
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
    }
  </div>
</ion-content>

<ion-footer class="ion-no-border">
  @if (pendingImage) {
  <app-media-preview [imageUrl]="pendingImage" (cancel)="cancelImage()">
  </app-media-preview>
  }

  <div class="floating-input-bar">
    @if (isRecording) {
    <div class="recording-indicator">
      <div class="recording-pulse"></div>
      <span>ƒêang ghi √¢m...</span>
      <button class="stop-btn" (click)="toggleRecording()">
        <ion-icon name="stop"></ion-icon>
      </button>
    </div>
    } @else {
    <button class="icon-btn new-chat-btn" (click)="startNewConversation()">
      <ion-icon name="add-outline"></ion-icon>
    </button>

    <div class="media-buttons">
      <button class="icon-btn" (click)="takePhoto()">
        <ion-icon name="camera-outline"></ion-icon>
      </button>
      <button class="icon-btn" (click)="pickPhoto()">
        <ion-icon name="image-outline"></ion-icon>
      </button>
      <button class="icon-btn mic-btn" [class.recording]="isRecording" (click)="toggleRecording()">
        <ion-icon name="mic-outline"></ion-icon>
      </button>
    </div>

    <input type="text" [(ngModel)]="newMessage" placeholder="H·ªèi v·ªÅ ƒê√† L·∫°t..." (keyup.enter)="sendMessage()"
      [disabled]="isRecording" />

    <button class="send-btn" (click)="sendMessage()" [disabled]="isLoading || isRecording || !newMessage?.trim()">
      <ion-icon name="paper-plane"></ion-icon>
    </button>
    }
  </div>
</ion-footer>
