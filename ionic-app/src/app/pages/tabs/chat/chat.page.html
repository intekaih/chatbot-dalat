<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>TÆ° váº¥n du lá»‹ch ÄÃ  Láº¡t</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="startNewConversation()" class="new-chat-btn">
        <ion-icon slot="icon-only" name="add-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content #chatContent>
  <div class="chat-container">
    @if (messages.length === 0 || (messages.length === 1 && messages[0].id === 'welcome')) {
      <div class="welcome-section">
        <div class="welcome-icon">
          <ion-icon name="leaf-outline"></ion-icon>
        </div>
        <h2>ChÃ o má»«ng Ä‘áº¿n ÄÃ  Láº¡t!</h2>
        <p>TÃ´i lÃ  trá»£ lÃ½ du lá»‹ch thÃ´ng minh. HÃ£y há»i tÃ´i báº¥t cá»© Ä‘iá»u gÃ¬ vá» thÃ nh phá»‘ ngÃ n hoa.</p>
        
        <div class="suggestion-chips">
          <button class="chip" (click)="askSuggestion('Äá»‹a Ä‘iá»ƒm ná»•i tiáº¿ng á»Ÿ ÄÃ  Láº¡t?')">
            ğŸ”ï¸ Äá»‹a Ä‘iá»ƒm ná»•i tiáº¿ng
          </button>
          <button class="chip" (click)="askSuggestion('MÃ³n Äƒn ngon á»Ÿ ÄÃ  Láº¡t?')">
            ğŸœ áº¨m thá»±c Ä‘áº·c sáº£n
          </button>
          <button class="chip" (click)="askSuggestion('QuÃ¡n cÃ  phÃª view Ä‘áº¹p?')">
            â˜• CÃ  phÃª view Ä‘áº¹p
          </button>
          <button class="chip" (click)="askSuggestion('Lá»‹ch trÃ¬nh 2 ngÃ y á»Ÿ ÄÃ  Láº¡t?')">
            ğŸ“… Lá»‹ch trÃ¬nh 2 ngÃ y
          </button>
        </div>
      </div>
    }

    @for (message of messages; track message.id) {
      @if (message.id !== 'welcome' || messages.length > 1) {
        <app-chat-bubble [message]="message"></app-chat-bubble>
      }
    }

    @if (isLoading) {
      <div class="typing-indicator">
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <span class="typing-text">Äang xá»­ lÃ½...</span>
      </div>
    }
  </div>
</ion-content>

<ion-footer class="ion-no-border">
  @if (pendingImage) {
    <app-media-preview 
      [imageUrl]="pendingImage" 
      (cancel)="cancelImage()">
    </app-media-preview>
  }

  <div class="floating-input-bar">
    @if (isRecording) {
      <div class="recording-indicator">
        <div class="recording-pulse"></div>
        <span>Äang ghi Ã¢m...</span>
      </div>
    } @else {
      <div class="media-buttons">
        <button class="icon-btn" (click)="takePhoto()">
          <ion-icon name="camera-outline"></ion-icon>
        </button>
        <button class="icon-btn" (click)="pickPhoto()">
          <ion-icon name="image-outline"></ion-icon>
        </button>
        <button class="icon-btn" [class.recording]="isRecording" (click)="toggleRecording()">
          <ion-icon [name]="isRecording ? 'stop-circle' : 'mic-outline'"></ion-icon>
        </button>
      </div>

      <input
        type="text"
        [(ngModel)]="newMessage"
        placeholder="Há»i vá» ÄÃ  Láº¡t..."
        (keyup.enter)="sendMessage()"
        [disabled]="isRecording" />

      <button class="send-btn" (click)="sendMessage()" [disabled]="isLoading || isRecording">
        <ion-icon name="send"></ion-icon>
      </button>
    }
  </div>
</ion-footer>
